import{b as T,n as P,p as C,v as F,w as S,a as j,P as K}from"./bootstrap-vEIqJ15Z.js";import{n as V}from"./ns-prompt-popup-CVlhnzqe.js";import{_,n as L}from"./currency-Dtag6qPd.js";import{_ as g}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as h,o as p,c as u,a as s,i as m,t as n,e as b,f as a,F as y,b as w,w as v,B as A}from"./runtime-core.esm-bundler-DWZrwskR.js";import"./chart-Cjxr_vbl.js";const B={data(){return{products:[],isLoading:!1}},props:["popup"],computed:{order(){return this.popup.params.order}},mounted(){this.loadProducts()},methods:{__:_,nsCurrency:L,close(){this.popup.params.reject(!1),this.popup.close()},loadProducts(){this.isLoading=!0;const t=this.popup.params.order.id;T.get(`/api/orders/${t}/products`).subscribe(e=>{this.isLoading=!1,this.products=e})},openOrder(){this.popup.close(),this.popup.params.resolve(this.order)}}},H={class:"shadow-lg ns-box w-6/7-screen md:w-3/5-screen lg:w-2/5-screen h-6/7-screen flex flex-col overflow-hidden"},N={class:"p-2 flex justify-between text-primary items-center border-b ns-box-header"},U={class:"font-semibold"},$={key:0},D={class:"flex-auto p-2 overflow-y-auto ns-box-body"},q={key:0,class:"flex-auto relative"},E={class:"h-full w-full flex items-center justify-center"},M={class:"flex-col border-b border-info-primary py-2"},R={class:"title font-semibold text-primary flex justify-between"},Y={class:"text-sm text-primary"},z={class:"flex justify-end p-2 border-t ns-box-footer"},G={class:"px-1"},I={class:"-mx-2 flex"},J={class:"px-1"},Q={class:"px-1"};function W(t,e,c,x,i,r){const d=h("ns-close-button"),l=h("ns-spinner"),f=h("ns-button");return p(),u("div",H,[s("div",N,[s("h3",U,[m(n(r.__("Products"))+" â€” "+n(r.order.code)+" ",1),r.order.title?(p(),u("span",$,"("+n(r.order.title)+")",1)):b("",!0)]),s("div",null,[a(d,{onClick:e[0]||(e[0]=O=>r.close())})])]),s("div",D,[i.isLoading?(p(),u("div",q,[s("div",E,[a(l)])])):b("",!0),i.isLoading?b("",!0):(p(!0),u(y,{key:1},w(i.products,O=>(p(),u("div",{class:"item",key:O.id},[s("div",M,[s("div",R,[s("span",null,n(O.name)+" (x"+n(O.quantity)+")",1),s("span",null,n(r.nsCurrency(t.price)),1)]),s("div",Y,[s("ul",null,[s("li",null,n(r.__("Unit"))+" : "+n(O.unit.name),1)])])])]))),128))]),s("div",z,[s("div",G,[s("div",I,[s("div",J,[a(f,{onClick:e[1]||(e[1]=O=>r.openOrder()),type:"info"},{default:v(()=>[m(n(r.__("Open")),1)]),_:1})]),s("div",Q,[a(f,{onClick:e[2]||(e[2]=O=>r.close()),type:"error"},{default:v(()=>[m(n(r.__("Close")),1)]),_:1})])])])])])}const X=g(B,[["render",W]]),Z={props:["orders"],data(){return{searchField:"",columns:{rightColumn:[],leftColumn:[]}}},watch:{orders(){this.$nextTick(()=>{P.doAction("ns-pos-pending-orders-refreshed",this.orders.map(t=>({order:t,dom:document.querySelector(`[data-order-id="${t.id}"]`)})))})}},mounted(){this.columns.leftColumn=P.applyFilters("ns-pending-orders-left-column",[{label:_("Code"),value:t=>t.code},{label:_("Cashier"),value:t=>t.user_username},{label:_("Total"),value:t=>t.total},{label:_("Tendered"),value:t=>t.tendered}]),this.columns.rightColumn=P.applyFilters("ns-pending-orders-right-column",[{label:_("Customer"),value:t=>`${t.customer_first_name} ${t.customer_last_name}`},{label:_("Date"),value:t=>t.created_at},{label:_("Type"),value:t=>t.type}]),this.popupCloser()},name:"ns-pos-pending-order",methods:{__:_,popupCloser:C,previewOrder(t){this.$emit("previewOrder",t)},proceedOpenOrder(t){this.$emit("proceedOpenOrder",t)},searchOrder(){this.$emit("searchOrder",this.searchField)},printOrder(t){this.$emit("printOrder",t)},kotOrder(t){this.$emit("kotOrder",t)}}},ee={class:"flex flex-auto flex-col overflow-hidden"},re={class:"p-1"},se={class:"flex rounded border-2 input-group info"},te=s("i",{class:"las la-search"},null,-1),oe={class:"mr-1 hidden md:visible"},ne={class:"overflow-y-auto flex flex-auto"},de={class:"flex p-2 flex-auto flex-col overflow-y-auto"},le=["data-order-id"],ie={class:"text-primary"},ae={class:"px-2"},pe={class:"flex flex-wrap -mx-4"},ue={class:"w-full md:w-1/2 px-2"},ce={class:"w-full md:w-1/2 px-2"},_e={class:"flex justify-end w-full mt-2"},fe={class:"flex rounded-lg overflow-hidden ns-buttons"},me=["onClick"],Oe=s("i",{class:"las la-lock-open"},null,-1),ve=["onClick"],he=s("i",{class:"las la-eye"},null,-1),xe=["onClick"],be=s("i",{class:"las la-print"},null,-1),ye=["onClick"],we=s("i",{class:"las la-print"},null,-1),ge={key:0,class:"h-full v-full items-center justify-center flex"},Pe={class:"text-semibold text-primary"};function Ce(t,e,c,x,i,r){return p(),u("div",ee,[s("div",re,[s("div",se,[A(s("input",{onKeyup:e[0]||(e[0]=S(d=>r.searchOrder(),["enter"])),"onUpdate:modelValue":e[1]||(e[1]=d=>i.searchField=d),type:"text",class:"p-2 outline-none flex-auto"},null,544),[[F,i.searchField]]),s("button",{onClick:e[2]||(e[2]=d=>r.searchOrder()),class:"w-16 md:w-24"},[te,s("span",oe,n(r.__("Search")),1)])])]),s("div",ne,[s("div",de,[(p(!0),u(y,null,w(c.orders,d=>(p(),u("div",{"data-order-id":d.id,class:"border-b ns-box-body w-full py-2 ns-order-line",key:d.id},[s("h3",ie,n(d.title||"Untitled Order"),1),s("div",ae,[s("div",pe,[s("div",ue,[(p(!0),u(y,null,w(i.columns.leftColumn,(l,f)=>(p(),u("p",{key:f,class:"text-sm text-primary"},[s("strong",null,n(l.label),1),m(" : "+n(l.value(d)),1)]))),128))]),s("div",ce,[(p(!0),u(y,null,w(i.columns.rightColumn,(l,f)=>(p(),u("p",{key:f,class:"text-sm text-primary"},[s("strong",null,n(l.label),1),m(" : "+n(l.value(d)),1)]))),128))])])]),s("div",_e,[s("div",fe,[s("button",{onClick:l=>r.proceedOpenOrder(d),class:"info outline-none px-2 py-1"},[Oe,m(" "+n(r.__("Open")),1)],8,me),s("button",{onClick:l=>r.previewOrder(d),class:"success outline-none px-2 py-1"},[he,m(" "+n(r.__("Products")),1)],8,ve),s("button",{onClick:l=>r.printOrder(d),class:"warning outline-none px-2 py-1"},[be,m(" "+n(r.__("Print")),1)],8,xe),s("button",{onClick:l=>r.kotOrder(d),class:"success outline-none px-2 py-1"},[we,m(" "+n(r.__("KOT")),1)],8,ye)])])],8,le))),128)),c.orders.length===0?(p(),u("div",ge,[s("h3",Pe,n(r.__("Nothing to display...")),1)])):b("",!0)])])])}const ke=g(Z,[["render",Ce]]),Te={props:["popup"],components:{nsPosPendingOrders:ke},methods:{__:_,popupResolver:j,popupCloser:C,searchOrder(t){nsHttpClient.get(`/api/crud/${this.active}?search=${t}`).subscribe(e=>{this.orders=e.data})},setActiveTab(t){this.active=t,this.loadOrderFromType(t)},openOrder(t){POS.loadOrder(t.id),this.popup.close()},loadOrderFromType(t){nsHttpClient.get(`/api/crud/${t}`).subscribe(e=>{this.orders=e.data})},previewOrder(t){new Promise((c,x)=>{Popup.show(X,{order:t,resolve:c,reject:x})}).then(c=>{this.proceedOpenOrder(t)},c=>c)},printOrder(t){POS.print.process(t.id,"sale")},kotOrder(t){POS.print.process(t.id,"kot")},proceedOpenOrder(t){if(POS.products.getValue().length>0)return Popup.show(V,{title:_("Confirm Your Action"),message:_("The cart is not empty. Opening an order will clear your cart would you proceed ?"),onAction:c=>{c&&this.openOrder(t)}});this.openOrder(t)}},data(){return{active:"ns.kot-orders",searchField:"",orders:[]}},mounted(){this.loadOrderFromType(this.active),this.popupCloser()}},Fe={class:"shadow-lg ns-box w-6/7-screen md:w-3/5-screen lg:w-2/5-screen h-6/7-screen flex flex-col overflow-hidden"},Se={class:"p-2 flex justify-between text-primary items-center ns-box-header border-b"},je={class:"font-semibold"},Ke={class:"p-2 flex overflow-hidden flex-auto ns-box-body"},Ve={class:"p-2 flex justify-between ns-box-footer border-t"},Le=s("div",null,null,-1);function Ae(t,e,c,x,i,r){const d=h("ns-close-button"),l=h("ns-pos-pending-orders"),f=h("ns-tabs-item"),O=h("ns-tabs"),k=h("ns-button");return p(),u("div",Fe,[s("div",Se,[s("h3",je,n(r.__("Orders")),1),s("div",null,[a(d,{onClick:e[0]||(e[0]=o=>c.popup.close())})])]),s("div",Ke,[a(O,{active:i.active,onChangeTab:e[21]||(e[21]=o=>r.setActiveTab(o))},{default:v(()=>[a(f,{identifier:"ns.kot-orders",label:r.__("KOT Orders"),padding:"p-0",class:"flex flex-col overflow-hidden"},{default:v(()=>[a(l,{orders:i.orders,onSearchOrder:e[1]||(e[1]=o=>r.searchOrder(o)),onPreviewOrder:e[2]||(e[2]=o=>r.previewOrder(o)),onPrintOrder:e[3]||(e[3]=o=>r.printOrder(o)),onKotOrder:e[4]||(e[4]=o=>r.kotOrder(o)),onProceedOpenOrder:e[5]||(e[5]=o=>r.proceedOpenOrder(o))},null,8,["orders"])]),_:1},8,["label"]),a(f,{identifier:"ns.hold-orders",label:r.__("On Hold"),padding:"p-0",class:"flex flex-col overflow-hidden"},{default:v(()=>[a(l,{orders:i.orders,onSearchOrder:e[6]||(e[6]=o=>r.searchOrder(o)),onPreviewOrder:e[7]||(e[7]=o=>r.previewOrder(o)),onPrintOrder:e[8]||(e[8]=o=>r.printOrder(o)),onKotOrder:e[9]||(e[9]=o=>r.kotOrder(o)),onProceedOpenOrder:e[10]||(e[10]=o=>r.proceedOpenOrder(o))},null,8,["orders"])]),_:1},8,["label"]),a(f,{identifier:"ns.unpaid-orders",label:r.__("Unpaid"),padding:"p-0",class:"flex flex-col overflow-hidden"},{default:v(()=>[a(l,{orders:i.orders,onSearchOrder:e[11]||(e[11]=o=>r.searchOrder(o)),onPreviewOrder:e[12]||(e[12]=o=>r.previewOrder(o)),onPrintOrder:e[13]||(e[13]=o=>r.printOrder(o)),onKotOrder:e[14]||(e[14]=o=>r.kotOrder(o)),onProceedOpenOrder:e[15]||(e[15]=o=>r.proceedOpenOrder(o))},null,8,["orders"])]),_:1},8,["label"]),a(f,{identifier:"ns.partially-paid-orders",label:r.__("Partially Paid"),padding:"p-0",class:"flex flex-col overflow-hidden"},{default:v(()=>[a(l,{orders:i.orders,onSearchOrder:e[16]||(e[16]=o=>r.searchOrder(o)),onPreviewOrder:e[17]||(e[17]=o=>r.previewOrder(o)),onPrintOrder:e[18]||(e[18]=o=>r.printOrder(o)),onKotOrder:e[19]||(e[19]=o=>r.kotOrder(o)),onProceedOpenOrder:e[20]||(e[20]=o=>r.proceedOpenOrder(o))},null,8,["orders"])]),_:1},8,["label"])]),_:1},8,["active"])]),s("div",Ve,[Le,s("div",null,[a(k,{onClick:e[22]||(e[22]=o=>c.popup.close()),type:"info"},{default:v(()=>[m(n(r.__("Close")),1)]),_:1})])])])}const Be=g(Te,[["render",Ae]]),He={name:"ns-pos-pending-orders-button",methods:{__:_,openPendingOrdersPopup(){K.show(Be)}}},Ne={class:"ns-button default"},Ue=s("i",{class:"mr-1 text-xl lar la-hand-pointer"},null,-1);function $e(t,e,c,x,i,r){return p(),u("div",Ne,[s("button",{onClick:e[0]||(e[0]=d=>r.openPendingOrdersPopup()),class:"rounded shadow flex-shrink-0 h-12 flex items-center px-2 py-1 text-sm"},[Ue,s("span",null,n(r.__("Orders")),1)])])}const ze=g(He,[["render",$e]]);export{ze as default};
